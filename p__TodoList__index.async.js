"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[130],{42914:function(Xo,lo,l){l.r(lo),l.d(lo,{default:function(){return Ko}});var yo=l(42122),a=l.n(yo),ho=l(861),uo=l.n(ho),Co=l(27424),B=l.n(Co),U=l(55375),Y=function(y){return y.TODO_LIST_ATOM="TODO_LIST_ATOM",y.NOT_DONE_TODO_LIST_ATOM_SELECTOR="NOT_DONE_TODO_LIST_ATOM_SELECTOR",y.DONE_TODO_LIST_ATOM_SELECTOR="DONE_TODO_LIST_ATOM_SELECTOR",y.CUR_TODO_LIST_ATOM_SELECTOR="CUR_TODO_LIST_ATOM_SELECTOR",y.CUR_ACTIVE_CATEGORY_DETAIL_SELECTOR="CUR_ACTIVE_CATEGORY_DETAIL_SELECTOR",y}({}),z=l(59731),Lo=l(38416),Q=l.n(Lo),w,I=function(y){return y.ALL="ALL",y.DONE="DONE",y.NOT_DONE="NOT_DONE",y}({}),X=(w={},Q()(w,I.ALL,"\u6240\u6709"),Q()(w,I.DONE,"\u5DF2\u5B8C\u6210"),Q()(w,I.NOT_DONE,"\u5F85\u529E"),w),h=l(96486),Oo=function(r,u,t){if((0,h.isArray)(r)){var v=(0,h.cloneDeep)(r),i=(0,h.pullAt)(v,u),n=B()(i,1),T=n[0];return v.splice(t,0,T),v}return r},L=l(22638),po=l(69483),J=l.n(po),N=l(67294),E=l(4480),G=(0,E.cn)({key:Y.TODO_LIST_ATOM,default:{isLoading:!1,todoList:[],categoryInfo:{curCategoryId:"",categoryList:[{id:"",title:U.sN}]},groupType:I.NOT_DONE}}),Io=(0,E.nZ)({key:Y.DONE_TODO_LIST_ATOM_SELECTOR,get:function(r){var u=r.get,t=u(G),v=t.todoList,i=t.categoryInfo;return(0,h.filter)(v,function(n){return(n==null?void 0:n.done)&&(i==null?void 0:i.curCategoryId)===((n==null?void 0:n.categoryId)||"")})}}),xo=(0,E.nZ)({key:Y.NOT_DONE_TODO_LIST_ATOM_SELECTOR,get:function(r){var u=r.get,t=u(G),v=t.todoList,i=t.categoryInfo;return(0,h.filter)(v,function(n){return!(n!=null&&n.done)&&(i==null?void 0:i.curCategoryId)===((n==null?void 0:n.categoryId)||"")})}}),mo=(0,E.nZ)({key:Y.CUR_TODO_LIST_ATOM_SELECTOR,get:function(r){var u=r.get,t=u(G),v=t.todoList,i=t.categoryInfo;return(0,h.filter)(v,function(n){return(i==null?void 0:i.curCategoryId)===((n==null?void 0:n.categoryId)||"")})}}),Do=(0,E.nZ)({key:Y.CUR_ACTIVE_CATEGORY_DETAIL_SELECTOR,get:function(r){var u=r.get,t=u(G),v=t.categoryInfo;return(0,h.find)(v==null?void 0:v.categoryList,function(i){return(i==null?void 0:i.id)===(v==null?void 0:v.curCategoryId)})}}),Eo=function(){var r=(0,E.FV)(G),u=B()(r,2),t=u[0],v=t.isLoading,i=t.todoList,n=t.categoryInfo,T=t.groupType,f=u[1],x=(0,E.sJ)(Io),p=(0,E.sJ)(xo),m=(0,E.sJ)(mo),O=(0,N.useMemo)(function(){return function(){switch(T){case I.ALL:return m;case I.DONE:return x;case I.NOT_DONE:return p;default:return[]}}()},[T,m,x,p]),Z=(0,E.sJ)(Do),A=(0,L.Z)(function(s){J().setItem(z.F.TODO_LIST_KEY,s)}),R=(0,L.Z)(function(s){J().setItem(z.F.TODO_CATEGORY_INFO_KEY,s)}),k=(0,L.Z)(function(s){var c=[].concat(uo()(i),[{id:"".concat(U.Xt).concat(new Date().getTime()),title:"",content:"",seq:"",done:!1,note:"",categoryId:s||""}]);f(function(d){return a()(a()({},d),{},{todoList:c})}),A(c)}),M=(0,L.Z)(function(s){var c=(0,h.filter)(i,function(d){return(d==null?void 0:d.id)!==s});f(function(d){return a()(a()({},d),{},{todoList:c})}),A(c)}),K=(0,L.Z)(function(s){var c=(0,h.filter)(i,function(d){return(d==null?void 0:d.categoryId)!==s});f(function(d){return a()(a()({},d),{},{todoList:c})}),A(c)}),H=(0,L.Z)(function(s){var c=s.id,d=(0,h.map)(i,function(o){return(o==null?void 0:o.id)===c?a()(a()({},o),s):o});f(function(o){return a()(a()({},o),{},{todoList:d})}),A(d)}),to=(0,L.Z)(function(){var s=a()(a()({},n),{},{categoryList:[].concat(uo()((n==null?void 0:n.categoryList)||[]),[{id:"".concat(U.Yy).concat(new Date().getTime()),title:U.Is}])});f(function(c){return a()(a()({},c),{},{categoryInfo:s})}),R(s)}),no=(0,L.Z)(function(s){if(s){var c,d=(0,h.findIndex)(n==null?void 0:n.categoryList,function(D){return(D==null?void 0:D.id)===s}),o=d===-1?"":(n==null||(c=n.categoryList[d-1])===null||c===void 0?void 0:c.id)||"",g=s!==(n==null?void 0:n.curCategoryId)?n==null?void 0:n.curCategoryId:o,C=(0,h.filter)(n==null?void 0:n.categoryList,function(D){return(D==null?void 0:D.id)!==s}),P=a()(a()({},n),{},{curCategoryId:g,categoryList:C});f(function(D){return a()(a()({},D),{},{categoryInfo:P})}),R(P),K(s)}}),eo=(0,L.Z)(function(s){var c=s.id,d=(0,h.map)(n==null?void 0:n.categoryList,function(g){return(g==null?void 0:g.id)===c?a()(a()({},g),s):g}),o=a()(a()({},n),{},{categoryList:d});f(function(g){return a()(a()({},g),{},{categoryInfo:o})}),R(o)}),ro=(0,L.Z)(function(s){var c=a()(a()({},n),{},{curCategoryId:s});f(function(d){return a()(a()({},d),{},{categoryInfo:c})}),R(c)}),io=(0,L.Z)(function(s){f(function(c){return a()(a()({},c),{},{groupType:s})})});(0,N.useEffect)(function(){f(function(d){return a()(a()({},d),{},{isLoading:!0})});var s=J().getItem(z.F.TODO_CATEGORY_INFO_KEY).then(function(d){d&&f(function(o){return a()(a()({},o),{},{categoryInfo:d})})}),c=J().getItem(z.F.TODO_LIST_KEY).then(function(d){d&&f(function(o){return a()(a()({},o),{},{todoList:d})})});Promise.all([s,c]).finally(function(){f(function(d){return a()(a()({},d),{},{isLoading:!1})})})},[]);var ao=function(c){var d,o,g=c.oldIndex,C=c.newIndex,P=(d=O[g])===null||d===void 0?void 0:d.id,D=(o=O[C])===null||o===void 0?void 0:o.id,Ho=(0,h.findIndex)(i,function(j){return(j==null?void 0:j.id)===P}),Qo=(0,h.findIndex)(i,function(j){return(j==null?void 0:j.id)===D}),go=Oo(i,Ho,Qo);f(function(j){return a()(a()({},j),{},{todoList:go})}),A(go)};return{isLoading:v,todoList:i,curTodoList:m,doneTodoList:x,notDoneTodoList:p,groupType:T,curDisplayTodoList:O,categoryInfo:n,curActiveCategoryDetail:Z,handleSetGroupType:io,handleAddTodoItem:k,handleRemoveTodoItem:M,handleUpdateTodoItem:H,handleSortTodoItemEnd:ao,handleAddCategory:to,handleRemoveCategory:no,handleUpdateCategory:eo,handleClickCategory:ro}},So=l(48689),Ao=l(55914),Zo=l(77554),$=l(97689),b=l(71230),F=l(15746),jo=l(56616),q=l(68916),_=l(67759),No=l(88942),V={"todo-item-wrapper":"todo-item-wrapper___tVFjc","check-box":"check-box___YMuVz",title:"title___yALYU",content:"content___MGx0F","delete-icon":"delete-icon___ZYcin"},e=l(85893),Ro=$.Z.Title,Mo=$.Z.Paragraph,Fo=function(r){var u=r.index,t=r.todoListItem,v=r.onUpdateItem,i=r.onRemoveItem,n=(0,N.useState)(!1),T=B()(n,2),f=T[0],x=T[1],p=(0,N.useRef)(null),m=(0,No.Z)(),O=B()(m,1),Z=O[0],A=function(){setTimeout(function(){return x(!0)})},R=(0,L.Z)(function(){f&&x(!1)}),k=(0,h.debounce)(function(M,K){v(a()({id:t==null?void 0:t.id},M))},200);return(0,Ao.Z)(R,p),(0,Zo.Z)(["enter","esc"],function(){f&&x(!1)}),(0,e.jsx)("div",{className:V["todo-item-wrapper"],children:f?(0,e.jsx)("div",{ref:p,children:(0,e.jsxs)(q.Z,{form:Z,initialValues:{title:(t==null?void 0:t.title)||"",content:(t==null?void 0:t.content)||""},onValuesChange:k,children:[(0,e.jsx)(q.Z.Item,{name:"title",label:"\u6807\u9898",children:(0,e.jsx)(_.Z,{})}),(0,e.jsx)(q.Z.Item,{name:"content",label:"\u5185\u5BB9",children:(0,e.jsx)(_.Z,{})})]})}):(0,e.jsx)($.Z,{children:(0,e.jsxs)(b.Z,{align:"middle",children:[(0,e.jsx)(F.Z,{style:{flex:"none"},children:(0,e.jsx)("div",{className:V["check-box"],children:(0,e.jsx)(jo.Z,{checked:t==null?void 0:t.done,onChange:function(){return v({id:t==null?void 0:t.id,done:!(t!=null&&t.done)})}})})}),(0,e.jsxs)(F.Z,{style:{flex:"1"},children:[(0,e.jsxs)(Ro,{className:V.title,level:2,onClick:A,children:[(0,e.jsx)("span",{children:"\u{1F516} "}),"".concat(u,": ").concat((t==null?void 0:t.title)||"")]}),(0,e.jsx)(Mo,{className:V.content,onClick:A,children:(t==null?void 0:t.content)||"\u586B\u5199 Todo \u5185\u5BB9..."})]}),(0,e.jsx)(F.Z,{style:{flex:"none"},children:(0,e.jsx)(So.Z,{className:V["delete-icon"],onClick:function(){return i(t==null?void 0:t.id)}})})]})})})},Po=Fo,Uo=function(r,u,t){var v=Math.round(t);if(v<0)return Promise.reject("bad duration");var i=r.scrollTop,n=u-i,T=Date.now(),f=function x(){var p=(Date.now()-T)/v;p>1&&(p=1);var m=.5*(1-Math.cos(Math.PI*p)),O=i+n*m;r.scrollTop=O,p<1&&requestAnimationFrame(x)};requestAnimationFrame(f)},Bo=function(r){var u=(0,N.useRef)(null),t=function(){if(u.current!==null){var i,n=u.current.scrollHeight;Uo(u.current,n,(i=r==null?void 0:r.duration)!==null&&i!==void 0?i:500)}};return(0,N.useEffect)(t,[u]),{domRef:u,scrollToBottom:t}},Yo=l(97937),so=l(24969),wo=l(33904),W=l(21612),vo=l(68508),Go=l(5737),oo=l(15867),co=l(78045),fo=l(92678),Vo=l(62666),ko=function(r){var u=r.curActiveCategoryDetail,t=r.onUpdateCategory,v=(0,N.useState)(!1),i=B()(v,2),n=i[0],T=i[1],f=(0,N.useRef)(),x=(0,L.Z)(function(){T(!0),setTimeout(function(){var O;f==null||(O=f.current)===null||O===void 0||O.focus()})}),p=(0,L.Z)((0,h.throttle)(function(O){var Z;t({id:u==null?void 0:u.id,title:O==null||(Z=O.target)===null||Z===void 0?void 0:Z.value})},200)),m=(0,L.Z)(function(){T(!1)});return n?(0,e.jsx)(_.Z,{ref:f,value:u==null?void 0:u.title,onBlur:m,onPressEnter:m,onChange:p,style:{marginBottom:"12px"}}):(0,e.jsx)(Vo.Z,{level:3,onClick:x,children:(u==null?void 0:u.title)||U.sN})},zo=ko,S={"layout-all-wrapper":"layout-all-wrapper___YzEYt","sider-wrapper":"sider-wrapper___WE5eN","side-menu":"side-menu___dM783","menu-item-container":"menu-item-container___ryyZw","menu-item-left-wrapper":"menu-item-left-wrapper___IMyuH","delete-button":"delete-button___gbw7P","layout-right-wrapper":"layout-right-wrapper___yPGhM","content-wrapper":"content-wrapper___hpw17","group-type-radio-group":"group-type-radio-group___rrp0Q","todo-list-content-wrapper":"todo-list-content-wrapper___v73us"},To=W.Z.Content,Jo=W.Z.Sider,Wo=function(){var r=Eo(),u=r.isLoading,t=r.curTodoList,v=r.doneTodoList,i=r.notDoneTodoList,n=r.curDisplayTodoList,T=r.categoryInfo,f=r.groupType,x=r.curActiveCategoryDetail,p=r.handleAddTodoItem,m=r.handleRemoveTodoItem,O=r.handleUpdateTodoItem,Z=r.handleSortTodoItemEnd,A=r.handleSetGroupType,R=r.handleAddCategory,k=r.handleRemoveCategory,M=r.handleUpdateCategory,K=r.handleClickCategory,H=Bo(),to=H.domRef,no=H.scrollToBottom,eo=[{todoType:I.ALL,count:(t==null?void 0:t.length)||0,status:X[I.ALL]},{todoType:I.NOT_DONE,count:(i==null?void 0:i.length)||0,status:X[I.NOT_DONE]},{todoType:I.DONE,count:(v==null?void 0:v.length)||0,status:X[I.DONE]}],ro=(0,h.map)(T==null?void 0:T.categoryList,function(o){return{key:o==null?void 0:o.id,label:o==null?void 0:o.title}}),io=(0,L.Z)(function(o){var g;A(o==null||(g=o.target)===null||g===void 0?void 0:g.value)}),ao=(0,L.Z)(function(o){K(o==null?void 0:o.key)}),s=(0,L.Z)(function(o){p(o),setTimeout(function(){return no()})}),c=(0,fo.W8)(function(o){var g=o.value,C=o.idx;return(0,e.jsx)(Po,{index:C+1,todoListItem:g,onUpdateItem:O,onRemoveItem:m},g==null?void 0:g.id)}),d=(0,fo.JN)(function(o){var g=o.items;return(0,e.jsx)("div",{children:(0,h.map)(g,function(C,P){return(0,e.jsx)(c,{index:P,value:C,idx:P},"item-".concat(C==null?void 0:C.id))})})});return(0,e.jsx)(wo._z,{header:{title:"Todo list",subTitle:"\u522B\u8BA9\u672A\u6765\u7684\u98CE\u9669\u5F71\u54CD\u73B0\u5728\u7684\u4F60"},loading:u,children:(0,e.jsxs)(W.Z,{className:S["layout-all-wrapper"],children:[(0,e.jsxs)(Jo,{className:S["sider-wrapper"],width:200,children:[(0,e.jsx)(vo.Z,{className:S["side-menu"],mode:"inline",defaultSelectedKeys:[T==null?void 0:T.curCategoryId],onClick:ao,selectedKeys:[T==null?void 0:T.curCategoryId],children:(0,h.map)(ro,function(o){return(0,e.jsx)(vo.Z.Item,{children:(0,e.jsxs)(b.Z,{justify:"space-between",className:S["menu-item-container"],children:[(0,e.jsx)(F.Z,{className:S["menu-item-left-wrapper"],children:(o==null?void 0:o.label)||U.sN}),(0,e.jsx)(F.Z,{children:(o==null?void 0:o.key)!==""&&(0,e.jsx)(Go.Z,{title:"\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u4EFB\u52A1\u8BA1\u5212\u5417\uFF1F",onConfirm:function(C){C==null||C.stopPropagation(),k(o==null?void 0:o.key)},onCancel:function(C){return C==null?void 0:C.stopPropagation()},okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",children:(0,e.jsx)(oo.ZP,{className:S["delete-button"],type:"text",icon:(0,e.jsx)(Yo.Z,{}),onClick:function(C){C.stopPropagation()}})})})]})},o==null?void 0:o.key)})}),(0,e.jsx)(oo.ZP,{size:"large",onClick:R,style:{width:"calc(100% - 8px)",margin:"0 4px 4px"},children:(0,e.jsx)(so.Z,{style:{display:"inline-block",width:"100%"}})})]}),(0,e.jsx)(W.Z,{className:S["layout-right-wrapper"],children:(0,e.jsxs)(To,{className:S["content-wrapper"],children:[(0,e.jsxs)(b.Z,{justify:"space-between",children:[(0,e.jsx)(F.Z,{children:(0,e.jsx)(co.ZP.Group,{className:S["group-type-radio-group"],onChange:io,value:f,children:(0,h.map)(eo,function(o){return(0,e.jsx)(co.ZP.Button,{value:o==null?void 0:o.todoType,children:"".concat(o==null?void 0:o.status," (").concat(o==null?void 0:o.count,")")},o==null?void 0:o.todoType)})})}),(0,e.jsx)(F.Z,{children:(0,e.jsxs)(oo.ZP,{type:"primary",size:"large",onClick:function(){return s(T==null?void 0:T.curCategoryId)},children:[(0,e.jsx)(so.Z,{}),"Add Todo"]},"add-todo")})]}),(0,e.jsx)(zo,{curActiveCategoryDetail:x,onUpdateCategory:M}),(0,e.jsx)(To,{ref:to,className:S["todo-list-content-wrapper"],children:(0,e.jsx)(d,{items:n,onSortEnd:Z,distance:1,lockAxis:"y",lockToContainerEdges:!0,lockOffset:"0%"})})]})})]})})},Ko=Wo}}]);
