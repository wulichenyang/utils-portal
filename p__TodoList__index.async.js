"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[130],{75457:function(qo,lo,d){d.r(lo),d.d(lo,{default:function(){return Xo}});var yo=d(42122),l=d.n(yo),ho=d(861),uo=d.n(ho),Co=d(27424),G=d.n(Co),P=d(55375),w=function(c){return c.TODO_LIST_ATOM="TODO_LIST_ATOM",c.NOT_DONE_TODO_LIST_ATOM_SELECTOR="NOT_DONE_TODO_LIST_ATOM_SELECTOR",c.DONE_TODO_LIST_ATOM_SELECTOR="DONE_TODO_LIST_ATOM_SELECTOR",c.CUR_TODO_LIST_ATOM_SELECTOR="CUR_TODO_LIST_ATOM_SELECTOR",c.CUR_ACTIVE_CATEGORY_DETAIL_SELECTOR="CUR_ACTIVE_CATEGORY_DETAIL_SELECTOR",c}({}),H=d(59731),Lo=d(38416),q=d.n(Lo),Y,I=function(c){return c.ALL="ALL",c.DONE="DONE",c.NOT_DONE="NOT_DONE",c}({}),oo=(Y={},q()(Y,I.ALL,"\u6240\u6709"),q()(Y,I.DONE,"\u5DF2\u5B8C\u6210"),q()(Y,I.NOT_DONE,"\u5F85\u529E"),Y),y=d(96486),mo=function(n,u,t){if((0,y.isArray)(n)){var v=(0,y.cloneDeep)(n),i=(0,y.pullAt)(v,u),e=G()(i,1),g=e[0];return v.splice(t,0,g),v}return n},h=d(22638),po=d(69483),X=d.n(po),x=d(67294),R=d(4480),V=(0,R.cn)({key:w.TODO_LIST_ATOM,default:{isLoading:!1,todoList:[],categoryInfo:{curCategoryId:"",categoryList:[{id:"",title:P.sN}]},groupType:I.NOT_DONE}}),Oo=(0,R.nZ)({key:w.DONE_TODO_LIST_ATOM_SELECTOR,get:function(n){var u=n.get,t=u(V),v=t.todoList,i=t.categoryInfo;return(0,y.filter)(v,function(e){return(e==null?void 0:e.done)&&(i==null?void 0:i.curCategoryId)===((e==null?void 0:e.categoryId)||"")})}}),Io=(0,R.nZ)({key:w.NOT_DONE_TODO_LIST_ATOM_SELECTOR,get:function(n){var u=n.get,t=u(V),v=t.todoList,i=t.categoryInfo;return(0,y.filter)(v,function(e){return!(e!=null&&e.done)&&(i==null?void 0:i.curCategoryId)===((e==null?void 0:e.categoryId)||"")})}}),xo=(0,R.nZ)({key:w.CUR_TODO_LIST_ATOM_SELECTOR,get:function(n){var u=n.get,t=u(V),v=t.todoList,i=t.categoryInfo;return(0,y.filter)(v,function(e){return(i==null?void 0:i.curCategoryId)===((e==null?void 0:e.categoryId)||"")})}}),Ao=(0,R.nZ)({key:w.CUR_ACTIVE_CATEGORY_DETAIL_SELECTOR,get:function(n){var u=n.get,t=u(V),v=t.categoryInfo;return(0,y.find)(v==null?void 0:v.categoryList,function(i){return(i==null?void 0:i.id)===(v==null?void 0:v.curCategoryId)})}}),Do=function(){var n=(0,R.FV)(V),u=G()(n,2),t=u[0],v=t.isLoading,i=t.todoList,e=t.categoryInfo,g=t.groupType,T=u[1],A=(0,R.sJ)(Oo),p=(0,R.sJ)(Io),D=(0,R.sJ)(xo),L=(0,x.useMemo)(function(){return function(){switch(g){case I.ALL:return D;case I.DONE:return A;case I.NOT_DONE:return p;default:return[]}}()},[g,D,A,p]),N=(0,R.sJ)(Ao),S=(0,h.Z)(function(s){X().setItem(H.F.TODO_LIST_KEY,s)}),O=(0,h.Z)(function(s){X().setItem(H.F.TODO_CATEGORY_INFO_KEY,s)}),z=(0,h.Z)(function(s){var o=[].concat(uo()(i),[{id:"".concat(P.Xt).concat(new Date().getTime()),title:"",content:"",seq:"",done:!1,note:"",categoryId:s||""}]);T(function(a){return l()(l()({},a),{},{todoList:o})}),S(o)}),F=(0,h.Z)(function(s){var o=(0,y.filter)(i,function(a){return(a==null?void 0:a.id)!==s});T(function(a){return l()(l()({},a),{},{todoList:o})}),S(o)}),K=(0,h.Z)(function(s){var o=(0,y.filter)(i,function(a){return(a==null?void 0:a.categoryId)!==s});T(function(a){return l()(l()({},a),{},{todoList:o})}),S(o)}),B=(0,h.Z)(function(s){var o=s.id,a=(0,y.map)(i,function(f){return(f==null?void 0:f.id)===o?l()(l()({},f),s):f});T(function(f){return l()(l()({},f),{},{todoList:a})}),S(a)}),J=(0,h.Z)(function(){var s=l()(l()({},e),{},{categoryList:[].concat(uo()((e==null?void 0:e.categoryList)||[]),[{id:"".concat(P.Yy).concat(new Date().getTime()),title:P.Is}])});T(function(o){return l()(l()({},o),{},{categoryInfo:s})}),O(s)}),W=(0,h.Z)(function(s){if(s){var o,a=(0,y.findIndex)(e==null?void 0:e.categoryList,function(E){return(E==null?void 0:E.id)===s}),f=a===-1?"":(e==null||(o=e.categoryList[a-1])===null||o===void 0?void 0:o.id)||"",Z=s!==(e==null?void 0:e.curCategoryId)?e==null?void 0:e.curCategoryId:f,ao=(0,y.filter)(e==null?void 0:e.categoryList,function(E){return(E==null?void 0:E.id)!==s}),_=l()(l()({},e),{},{curCategoryId:Z,categoryList:ao});T(function(E){return l()(l()({},E),{},{categoryInfo:_})}),O(_),K(s)}}),$=(0,h.Z)(function(s){var o=s.id,a=(0,y.map)(e==null?void 0:e.categoryList,function(Z){return(Z==null?void 0:Z.id)===o?l()(l()({},Z),s):Z}),f=l()(l()({},e),{},{categoryList:a});T(function(Z){return l()(l()({},Z),{},{categoryInfo:f})}),O(f)}),C=(0,h.Z)(function(s){var o=l()(l()({},e),{},{curCategoryId:s});T(function(a){return l()(l()({},a),{},{categoryInfo:o})}),O(o)}),m=(0,h.Z)(function(s){T(function(o){return l()(l()({},o),{},{groupType:s})})});(0,x.useEffect)(function(){T(function(a){return l()(l()({},a),{},{isLoading:!0})});var s=X().getItem(H.F.TODO_CATEGORY_INFO_KEY).then(function(a){a&&T(function(f){return l()(l()({},f),{},{categoryInfo:a})})}),o=X().getItem(H.F.TODO_LIST_KEY).then(function(a){a&&T(function(f){return l()(l()({},f),{},{todoList:a})})});Promise.all([s,o]).finally(function(){T(function(a){return l()(l()({},a),{},{isLoading:!1})})})},[]);var Q=function(o){var a,f,Z=o.oldIndex,ao=o.newIndex,_=(a=L[Z])===null||a===void 0?void 0:a.id,E=(f=L[ao])===null||f===void 0?void 0:f.id,bo=(0,y.findIndex)(i,function(M){return(M==null?void 0:M.id)===_}),_o=(0,y.findIndex)(i,function(M){return(M==null?void 0:M.id)===E}),go=mo(i,bo,_o);T(function(M){return l()(l()({},M),{},{todoList:go})}),S(go)};return{isLoading:v,todoList:i,curTodoList:D,doneTodoList:A,notDoneTodoList:p,groupType:g,curDisplayTodoList:L,categoryInfo:e,curActiveCategoryDetail:N,handleSetGroupType:m,handleAddTodoItem:z,handleRemoveTodoItem:F,handleUpdateTodoItem:B,handleSortTodoItemEnd:Q,handleAddCategory:J,handleRemoveCategory:W,handleUpdateCategory:$,handleClickCategory:C}},So=function(n,u,t){var v=Math.round(t);if(v<0)return Promise.reject("bad duration");var i=n.scrollTop,e=u-i,g=Date.now(),T=function A(){var p=(Date.now()-g)/v;p>1&&(p=1);var D=.5*(1-Math.cos(Math.PI*p)),L=i+e*D;n.scrollTop=L,p<1&&requestAnimationFrame(A)};requestAnimationFrame(T)},Zo=function(n){var u=(0,x.useRef)(null),t=function(){if(u.current!==null){var i,e=u.current.scrollHeight;So(u.current,e,(i=n==null?void 0:n.duration)!==null&&i!==void 0?i:500)}};return(0,x.useEffect)(t,[u]),{domRef:u,scrollToBottom:t}},Eo=d(97937),vo=d(24969),Ro=d(33904),b=d(21612),so=d(68508),to=d(71230),U=d(15746),jo=d(5737),eo=d(15867),co=d(78045),No=d(48689),Mo=d(55914),Uo=d(77554),no=d(97689),ro=d(67759),Po=d(56616),io=d(68916),Fo=d(88942),k={"todo-item-wrapper":"todo-item-wrapper___mQ3WK","check-box":"check-box___BtGdO",title:"title___A7EVV",content:"content___ZJKzG","delete-icon":"delete-icon___RQmjp"},r=d(85893),Bo=no.Z.Title,Go=no.Z.Paragraph,wo=ro.Z.TextArea,Yo=function(n){var u=n.index,t=n.todoListItem,v=n.onUpdateItem,i=n.onRemoveItem,e=(0,x.useState)(!1),g=G()(e,2),T=g[0],A=g[1],p=(0,Fo.Z)(),D=G()(p,1),L=D[0],N=(0,x.useRef)(null),S=(0,x.useRef)(null),O=(0,x.useRef)(null),z=(0,x.useMemo)(function(){var C;return t!=null&&(C=t.content)!==null&&C!==void 0&&C.trim()?(0,y.map)((0,y.split)(t==null?void 0:t.content,`
`),function(m,Q){return(0,r.jsx)("div",{children:m},Q)}):"\u586B\u5199 Todo \u5185\u5BB9..."},[t==null?void 0:t.content]),F=(0,h.Z)(function(C){setTimeout(function(){A(!0),C()})}),K=(0,h.Z)(function(){F(function(){return setTimeout(function(){var C;return S==null||(C=S.current)===null||C===void 0?void 0:C.focus()})})}),B=(0,h.Z)(function(){F(function(){return setTimeout(function(){var C,m;O==null||(C=O.current)===null||C===void 0||C.focus(),O==null||(m=O.current)===null||m===void 0||(m=m.resizableTextArea)===null||m===void 0||(m=m.textArea)===null||m===void 0||m.setSelectionRange(-1,-1)})})}),J=(0,h.Z)(function(){T&&A(!1)}),W=(0,h.Z)((0,y.debounce)(function(C,m){v(l()({id:t==null?void 0:t.id},C))},200)),$=(0,h.Z)(function(C){C.shiftKey||T&&A(!1)});return(0,Mo.Z)(J,N),(0,Uo.Z)(["enter","esc"],$),(0,r.jsx)("div",{className:k["todo-item-wrapper"],children:T?(0,r.jsx)("div",{ref:N,children:(0,r.jsxs)(io.Z,{form:L,initialValues:{title:(t==null?void 0:t.title)||"",content:(t==null?void 0:t.content)||""},onValuesChange:W,children:[(0,r.jsx)(io.Z.Item,{name:"title",label:"\u6807\u9898",children:(0,r.jsx)(ro.Z,{ref:S,bordered:!1})}),(0,r.jsx)(io.Z.Item,{name:"content",label:"\u5185\u5BB9",children:(0,r.jsx)(wo,{ref:O,bordered:!1})})]})}):(0,r.jsx)(no.Z,{children:(0,r.jsxs)(to.Z,{align:"middle",children:[(0,r.jsx)(U.Z,{style:{flex:"none"},children:(0,r.jsx)("div",{className:k["check-box"],children:(0,r.jsx)(Po.Z,{checked:t==null?void 0:t.done,onChange:function(){return v({id:t==null?void 0:t.id,done:!(t!=null&&t.done)})}})})}),(0,r.jsxs)(U.Z,{style:{flex:"1"},children:[(0,r.jsxs)(Bo,{className:k.title,level:2,onClick:K,children:[(0,r.jsx)("span",{children:"\u{1F516} "}),"".concat(u,": ").concat((t==null?void 0:t.title)||"")]}),(0,r.jsx)(Go,{className:k.content,onClick:B,children:z})]}),(0,r.jsx)(U.Z,{style:{flex:"none"},children:(0,r.jsx)(No.Z,{className:k["delete-icon"],onClick:function(){return i(t==null?void 0:t.id)}})})]})})})},Vo=(0,x.memo)(Yo),fo=d(92678),ko=(0,fo.W8)(function(c){var n=c.value,u=c.idx,t=c.onUpdateItem,v=c.onRemoveItem;return(0,r.jsx)(Vo,{index:u+1,todoListItem:n,onUpdateItem:t,onRemoveItem:v},n==null?void 0:n.id)}),zo=(0,fo.JN)(function(c){var n=c.items,u=c.onUpdateItem,t=c.onRemoveItem;return(0,r.jsx)("div",{children:(0,y.map)(n,function(v,i){return(0,r.jsx)(ko,{index:i,value:v,idx:i,onUpdateItem:u,onRemoveItem:t},"item-".concat(v==null?void 0:v.id))})})}),Ko=(0,x.memo)(zo),Jo=d(62666),Wo=function(n){var u=n.curActiveCategoryDetail,t=n.onUpdateCategory,v=(0,x.useState)(!1),i=G()(v,2),e=i[0],g=i[1],T=(0,x.useRef)(),A=(0,h.Z)(function(){g(!0),setTimeout(function(){var L;T==null||(L=T.current)===null||L===void 0||L.focus()})}),p=(0,h.Z)((0,y.throttle)(function(L){var N;t({id:u==null?void 0:u.id,title:L==null||(N=L.target)===null||N===void 0?void 0:N.value})},200)),D=(0,h.Z)(function(){g(!1)});return e?(0,r.jsx)(ro.Z,{ref:T,value:u==null?void 0:u.title,onBlur:D,onPressEnter:D,onChange:p,style:{marginBottom:"12px"}}):(0,r.jsx)(Jo.Z,{level:3,onClick:A,children:(u==null?void 0:u.title)||P.sN})},$o=Wo,j={"layout-all-wrapper":"layout-all-wrapper___YzEYt","sider-wrapper":"sider-wrapper___WE5eN","side-menu":"side-menu___dM783","menu-item-container":"menu-item-container___ryyZw","menu-item-left-wrapper":"menu-item-left-wrapper___IMyuH","delete-button":"delete-button___gbw7P","layout-right-wrapper":"layout-right-wrapper___yPGhM","content-wrapper":"content-wrapper___hpw17","group-type-radio-group":"group-type-radio-group___rrp0Q","todo-list-content-wrapper":"todo-list-content-wrapper___v73us"},To=b.Z.Content,Qo=b.Z.Sider,Ho=function(){var n=Do(),u=n.isLoading,t=n.curTodoList,v=n.doneTodoList,i=n.notDoneTodoList,e=n.curDisplayTodoList,g=n.categoryInfo,T=n.groupType,A=n.curActiveCategoryDetail,p=n.handleAddTodoItem,D=n.handleRemoveTodoItem,L=n.handleUpdateTodoItem,N=n.handleSortTodoItemEnd,S=n.handleSetGroupType,O=n.handleAddCategory,z=n.handleRemoveCategory,F=n.handleUpdateCategory,K=n.handleClickCategory,B=Zo(),J=B.domRef,W=B.scrollToBottom,$=[{todoType:I.ALL,count:(t==null?void 0:t.length)||0,status:oo[I.ALL]},{todoType:I.NOT_DONE,count:(i==null?void 0:i.length)||0,status:oo[I.NOT_DONE]},{todoType:I.DONE,count:(v==null?void 0:v.length)||0,status:oo[I.DONE]}],C=(0,y.map)(g==null?void 0:g.categoryList,function(o){return{key:o==null?void 0:o.id,label:o==null?void 0:o.title}}),m=(0,h.Z)(function(o){var a;S(o==null||(a=o.target)===null||a===void 0?void 0:a.value)}),Q=(0,h.Z)(function(o){K(o==null?void 0:o.key)}),s=(0,h.Z)(function(o){p(o),setTimeout(function(){return W()})});return(0,r.jsx)(Ro._z,{header:{title:"Todo list",subTitle:"\u522B\u8BA9\u672A\u6765\u7684\u98CE\u9669\u5F71\u54CD\u73B0\u5728\u7684\u4F60"},loading:u,children:(0,r.jsxs)(b.Z,{className:j["layout-all-wrapper"],children:[(0,r.jsxs)(Qo,{className:j["sider-wrapper"],width:200,children:[(0,r.jsx)(so.Z,{className:j["side-menu"],mode:"inline",defaultSelectedKeys:[g==null?void 0:g.curCategoryId],onClick:Q,selectedKeys:[g==null?void 0:g.curCategoryId],children:(0,y.map)(C,function(o){return(0,r.jsx)(so.Z.Item,{children:(0,r.jsxs)(to.Z,{justify:"space-between",className:j["menu-item-container"],children:[(0,r.jsx)(U.Z,{className:j["menu-item-left-wrapper"],children:(o==null?void 0:o.label)||P.sN}),(0,r.jsx)(U.Z,{children:(o==null?void 0:o.key)!==""&&(0,r.jsx)(jo.Z,{title:"\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u4EFB\u52A1\u8BA1\u5212\u5417\uFF1F",onConfirm:function(f){f==null||f.stopPropagation(),z(o==null?void 0:o.key)},onCancel:function(f){return f==null?void 0:f.stopPropagation()},okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",children:(0,r.jsx)(eo.ZP,{className:j["delete-button"],type:"text",icon:(0,r.jsx)(Eo.Z,{}),onClick:function(f){f.stopPropagation()}})})})]})},o==null?void 0:o.key)})}),(0,r.jsx)(eo.ZP,{size:"large",onClick:O,style:{width:"calc(100% - 8px)",margin:"0 4px 4px"},children:(0,r.jsx)(vo.Z,{style:{display:"inline-block",width:"100%"}})})]}),(0,r.jsx)(b.Z,{className:j["layout-right-wrapper"],children:(0,r.jsxs)(To,{className:j["content-wrapper"],children:[(0,r.jsxs)(to.Z,{justify:"space-between",children:[(0,r.jsx)(U.Z,{children:(0,r.jsx)(co.ZP.Group,{className:j["group-type-radio-group"],onChange:m,value:T,children:(0,y.map)($,function(o){return(0,r.jsx)(co.ZP.Button,{value:o==null?void 0:o.todoType,children:"".concat(o==null?void 0:o.status," (").concat(o==null?void 0:o.count,")")},o==null?void 0:o.todoType)})})}),(0,r.jsx)(U.Z,{children:(0,r.jsxs)(eo.ZP,{type:"primary",size:"large",onClick:function(){return s(g==null?void 0:g.curCategoryId)},children:[(0,r.jsx)(vo.Z,{}),"Add Todo"]},"add-todo")})]}),(0,r.jsx)($o,{curActiveCategoryDetail:A,onUpdateCategory:F}),(0,r.jsx)(To,{ref:J,className:j["todo-list-content-wrapper"],children:(0,r.jsx)(Ko,{items:e,distance:1,lockAxis:"y",lockToContainerEdges:!0,lockOffset:"0%",onSortEnd:N,onRemoveItem:D,onUpdateItem:L})})]})})]})})},Xo=Ho}}]);
